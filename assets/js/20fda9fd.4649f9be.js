"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[463],{2278:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"custom-reporters","title":"Implementing a Custom Reporter","description":"While Liquibase Linter has some good core reporters, you may have a use case that\'s particular to your project and","source":"@site/docs/custom-reporters.md","sourceDirName":".","slug":"/custom-reporters","permalink":"/liquibase-linter/docs/custom-reporters","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Implementing a Custom Reporter"},"sidebar":"docs","previous":{"title":"Text","permalink":"/liquibase-linter/docs/reporting/text"}}');var i=r(4848),o=r(8453);const s={title:"Implementing a Custom Reporter"},a=void 0,c={},l=[{value:"Writing the reporter",id:"writing-the-reporter",level:2},{value:"Sample <code>Reporter</code> implementation",id:"sample-reporter-implementation",level:3},{value:"Making the reporter discoverable",id:"making-the-reporter-discoverable",level:2},{value:"Configuring the reporter in Maven",id:"configuring-the-reporter-in-maven",level:2},{value:"Adding custom config to the <code>Reporter</code>",id:"adding-custom-config-to-the-reporter",level:2}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"While Liquibase Linter has some good core reporters, you may have a use case that's particular to your project and\nwouldn't make sense as a core reporter."}),"\n",(0,i.jsx)(t.p,{children:"Fortunately it's trivial to implement custom reporters and apply them in your own project; you just need to write a\nJava class implementing the reporting interface and do a little configuration."}),"\n",(0,i.jsx)(t.h2,{id:"writing-the-reporter",children:"Writing the reporter"}),"\n",(0,i.jsx)(t.p,{children:"There are a few interfaces to implement when writing a custom reporter in Java:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/liquibase-linter/liquibase-linter/blob/main/src/main/java/io/github/liquibaselinter/report/Reporter.java",children:"Reporter"})," is the actual interface that your reporter must implement"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.a,{href:"https://github.com/liquibase-linter/liquibase-linter/blob/main/src/main/java/io/github/liquibaselinter/report/Reporter.java",children:"Reporter.Factory"})," is the piece which ties the reporter into the ",(0,i.jsx)(t.code,{children:"lqlint.json"})," configuration."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Fortunately, there are existing abstract classes that make this easy to do. Furthermore, the ",(0,i.jsx)(t.code,{children:"Reporter.Factory"})," can\nexist as inner classes to the main ",(0,i.jsx)(t.code,{children:"Reporter"})," implementation."]}),"\n",(0,i.jsxs)(t.h3,{id:"sample-reporter-implementation",children:["Sample ",(0,i.jsx)(t.code,{children:"Reporter"})," implementation"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:'package com.fake.fancyapp.liquibase;\n\nimport report.io.github.liquibaselinter.AbstractReporter;\nimport report.io.github.liquibaselinter.Report;\nimport report.io.github.liquibaselinter.ReporterConfig;\nimport report.io.github.liquibaselinter.ReportItem;\n\nimport java.util.List;\nimport java.io.PrintWriter;\n\npublic class CustomReporter extends AbstractReporter {\n    private static final String NAME = "custom-reporter";\n\n    public CustomReporter(ReporterConfig config) {\n        super(config, "ext"); // reports will have a `.ext` file extension\n    }\n\n    @Override\n    protected void printReport(PrintWriter output, Report report, List<ReportItem> items) {\n        // The \'items\' have already been filtered.\n        // All that is left to do is produce the output.\n        // Alternatively, extend an existing core reporter and override methods.\n    }\n\n    public static class Factory extends AbstractReporter.Factory<CustomReporter> {\n        public Factory() {\n            super(NAME);\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"Some notes about how we've done this:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Extend the ",(0,i.jsx)(t.code,{children:"AbstractReporter"})," class, which saves us from creating a lot of boilerplate ourselves."]}),"\n",(0,i.jsxs)(t.li,{children:["Create ",(0,i.jsx)(t.code,{children:"Factory"}),". This links the ",(0,i.jsx)(t.code,{children:"CustomReporter"})," to the Liquibase Linter configuration."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["All the core reporters are implemented in this way as well, so if you're not sure how best to hook something up you\nmight try looking in the source at\n",(0,i.jsx)(t.a,{href:"https://github.com/liquibase-linter/liquibase-linter/tree/main/src/main/java/io/github/liquibaselinter/report",children:"some existing core reporters"}),"\nthat do something similar"]}),"\n",(0,i.jsx)(t.h2,{id:"making-the-reporter-discoverable",children:"Making the reporter discoverable"}),"\n",(0,i.jsxs)(t.p,{children:["The class above should go into a new Maven project that depends on both ",(0,i.jsx)(t.code,{children:"liquibase-linter"})," and ",(0,i.jsx)(t.code,{children:"liquibase"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The fact that the class exists isn't quite enough on its own; we need to tell Liquibase Linter that it's there. For this\nwe are using the ",(0,i.jsx)(t.a,{href:"https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html",children:"Service Provider Interface"})," pattern -\nthis is natively supported in Java and for use cases like this is preferable to powerful-but-heavy classpath scanning\napproaches like that used by Spring."]}),"\n",(0,i.jsx)(t.p,{children:"In our newly-created project, we'll create a new file at:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"src/main/resources/META-INF/services/report.io.github.liquibaselinter.Reporter.Factory"})}),"\n",(0,i.jsx)(t.p,{children:"And in the file, we'll write:"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.code,{children:"com.fake.fancyapp.liquibase.CustomReporter.Factory"})}),"\n",(0,i.jsx)(t.h2,{id:"configuring-the-reporter-in-maven",children:"Configuring the reporter in Maven"}),"\n",(0,i.jsxs)(t.p,{children:["In the project where our scripts live, we'll add a dependency on our reporters project to ",(0,i.jsx)(t.code,{children:"liquibase-maven-plugin"}),", in\nmuch the same way that we ",(0,i.jsxs)(t.a,{href:"/liquibase-linter/docs/configure",children:["added a dependency for ",(0,i.jsx)(t.code,{children:"liquibase-linter"})," originally"]}),".\nSo for our example custom reporting project ",(0,i.jsx)(t.code,{children:"wcg-liquibase-linter"})," we would have the following dependency."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-xml",children:"<plugin>\n    <groupId>org.liquibase</groupId>\n    <artifactId>liquibase-maven-plugin</artifactId>\n    <configuration>\n        ...\n    </configuration>\n    <dependencies>\n        <dependency>\n            <groupId>io.github.liquibase-linter</groupId>\n            <artifactId>liquibase-parser-extension</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>com.fake.fancyapp</groupId>\n            <artifactId>liquibase-reporters</artifactId>\n            <version>0.1.0</version>\n        </dependency>\n    </dependencies>\n    <executions>\n        ...\n    </executions>\n</plugin>\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Then all we need is to ",(0,i.jsx)(t.a,{href:"/liquibase-linter/docs/reporting/",children:"configure the reporter as normal"})," in ",(0,i.jsx)(t.code,{children:"lqlint.json"}),"."]}),"\n",(0,i.jsxs)(t.h2,{id:"adding-custom-config-to-the-reporter",children:["Adding custom config to the ",(0,i.jsx)(t.code,{children:"Reporter"})]}),"\n",(0,i.jsxs)(t.p,{children:["If additional configuration opens are required for the ",(0,i.jsx)(t.code,{children:"CustomReporter"})," to operate, extend ",(0,i.jsx)(t.code,{children:"ReporterConfig"})," and create\na new builder that extends ",(0,i.jsx)(t.code,{children:"ReporterConfig.BaseBuilder"})," and change the ",(0,i.jsx)(t.code,{children:"Factory"})," to extend ",(0,i.jsx)(t.code,{children:"ReporterConfig.BaseFactory"}),",\nadding in the ",(0,i.jsx)(t.code,{children:"Config"})," class to the generic type declaration. Add ",(0,i.jsx)(t.code,{children:"@JsonDeserialize"})," to the ",(0,i.jsx)(t.code,{children:"Config"})," class so that the\n",(0,i.jsx)(t.code,{children:"CustomReporter.Config"})," can be loaded from the Liquibase Linter configuration."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-java",children:"package com.fake.fancyapp.liquibase;\n\nimport com.fasterxml.jackson.databind.annotation.JsonDeserialize;\nimport report.io.github.liquibaselinter.AbstractReporter;\nimport report.io.github.liquibaselinter.Report;\nimport report.io.github.liquibaselinter.ReporterConfig;\nimport report.io.github.liquibaselinter.ReportItem;\n\nimport java.util.List;\nimport java.io.PrintWriter;\n\npublic class CustomReporter extends AbstractReporter {\n    private static final String NAME = \"custom-reporter\";\n\n    final String customConfigOption;\n\n    protected CustomReporter(CustomReporter.Config config) {\n        super(config);\n        this.customConfigOption = config.customConfigOption;\n    }\n\n    @Override\n    protected void printReport(PrintWriter output, Report report, List<ReportItem> items) {\n        // The 'items' have already been filtered.\n        // All that is left to do is produce the output.\n        // Alternatively, extend an existing core reporter and override methods.\n    }\n\n    public static class Factory extends AbstractReporter.BaseFactory<CustomReporter, Config> {\n        public Factory() {\n            super(NAME);\n        }\n    }\n\n    @JsonDeserialize(builder = Builder.class)\n    public static class Config extends ReporterConfig {\n        final String customConfigOption;\n\n        public Config(Builder builder) {\n            super(builder);\n            customConfigOption = builder.customConfigOption;\n        }\n    }\n\n    public static class Builder extends ReporterConfig.BaseBuilder<Builder> {\n        String customConfigOption;\n\n        public Builder withCustomConfigOption(String customConfigOption) {\n            this.customConfigOption = customConfigOption;\n            return this;\n        }\n\n        @Override\n        public Config build() {\n            return new Config(this);\n        }\n    }\n}\n"})})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>a});var n=r(6540);const i={},o=n.createContext(i);function s(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);